/**
 * Copyright (c) 2024 Torkild Ulvøy Resheim
 *
 * This program and the accompanying materials are made
 * available under the terms of the Eclipse Public License 2.0
 * which is available at https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *
 *   Torkild Ulvøy Resheim <torkildr@gmail.com> - initial API and implementation
 */
package net.resheim.eclipse.cc.ui.debug;

import org.eclipse.debug.core.DebugEvent;
import org.eclipse.debug.core.DebugException;
import org.eclipse.debug.core.DebugPlugin;
import org.eclipse.debug.core.IDebugEventSetListener;
import org.eclipse.debug.core.model.IMemoryBlock;
import org.eclipse.debug.ui.memory.AbstractMemoryRendering;
import org.eclipse.jface.layout.GridDataFactory;
import org.eclipse.swt.SWT;
import org.eclipse.swt.events.ModifyEvent;
import org.eclipse.swt.events.ModifyListener;
import org.eclipse.swt.events.SelectionAdapter;
import org.eclipse.swt.events.SelectionEvent;
import org.eclipse.swt.graphics.GC;
import org.eclipse.swt.graphics.Image;
import org.eclipse.swt.graphics.ImageData;
import org.eclipse.swt.graphics.PaletteData;
import org.eclipse.swt.graphics.RGB;
import org.eclipse.swt.layout.GridLayout;
import org.eclipse.swt.widgets.Canvas;
import org.eclipse.swt.widgets.Combo;
import org.eclipse.swt.widgets.Composite;
import org.eclipse.swt.widgets.Control;
import org.eclipse.swt.widgets.Label;
import org.eclipse.swt.widgets.Text;

/**
 * Experimental character map rendering.
 */
public class CharacterMapRendering extends AbstractMemoryRendering implements IDebugEventSetListener {
	private static final int CHAR_SIZE = 8; // Width and height of each character in pixels
	/** Images representing each glyph in all the available character sets */
	public static Image[][] CHARACTER = new Image[5][256];

	/** Root composite */
	private Composite fRoot;
	/** The currently selected font */
	private int fontIndex = 0;

	/** The Commodore 64 upper case character set */
	private static int[] C64_UPPERCASE = { 60, 102, 110, 110, 96, 98, 60, 0, 24, 60, 102, 126, 102, 102, 102, 0, 124,
			102, 102, 124, 102, 102, 124, 0, 60, 102, 96, 96, 96, 102, 60, 0, 120, 108, 102, 102, 102, 108, 120, 0, 126,
			96, 96, 120, 96, 96, 126, 0, 126, 96, 96, 120, 96, 96, 96, 0, 60, 102, 96, 110, 102, 102, 60, 0, 102, 102,
			102, 126, 102, 102, 102, 0, 60, 24, 24, 24, 24, 24, 60, 0, 30, 12, 12, 12, 12, 108, 56, 0, 102, 108, 120,
			112, 120, 108, 102, 0, 96, 96, 96, 96, 96, 96, 126, 0, 99, 119, 127, 107, 99, 99, 99, 0, 102, 118, 126, 126,
			110, 102, 102, 0, 60, 102, 102, 102, 102, 102, 60, 0, 124, 102, 102, 124, 96, 96, 96, 0, 60, 102, 102, 102,
			102, 60, 14, 0, 124, 102, 102, 124, 120, 108, 102, 0, 60, 102, 96, 60, 6, 102, 60, 0, 126, 24, 24, 24, 24,
			24, 24, 0, 102, 102, 102, 102, 102, 102, 60, 0, 102, 102, 102, 102, 102, 60, 24, 0, 99, 99, 99, 107, 127,
			119, 99, 0, 102, 102, 60, 24, 60, 102, 102, 0, 102, 102, 102, 60, 24, 24, 24, 0, 126, 6, 12, 24, 48, 96,
			126, 0, 60, 48, 48, 48, 48, 48, 60, 0, 12, 18, 48, 124, 48, 98, 252, 0, 60, 12, 12, 12, 12, 12, 60, 0, 0,
			24, 60, 126, 24, 24, 24, 24, 0, 16, 48, 127, 127, 48, 16, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 24, 24, 24, 0, 0,
			24, 0, 102, 102, 102, 0, 0, 0, 0, 0, 102, 102, 255, 102, 255, 102, 102, 0, 24, 62, 96, 60, 6, 124, 24, 0,
			98, 102, 12, 24, 48, 102, 70, 0, 60, 102, 60, 56, 103, 102, 63, 0, 6, 12, 24, 0, 0, 0, 0, 0, 12, 24, 48, 48,
			48, 24, 12, 0, 48, 24, 12, 12, 12, 24, 48, 0, 0, 102, 60, 255, 60, 102, 0, 0, 0, 24, 24, 126, 24, 24, 0, 0,
			0, 0, 0, 0, 0, 24, 24, 48, 0, 0, 0, 126, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 24, 0, 0, 3, 6, 12, 24, 48, 96, 0,
			60, 102, 110, 118, 102, 102, 60, 0, 24, 24, 56, 24, 24, 24, 126, 0, 60, 102, 6, 12, 48, 96, 126, 0, 60, 102,
			6, 28, 6, 102, 60, 0, 6, 14, 30, 102, 127, 6, 6, 0, 126, 96, 124, 6, 6, 102, 60, 0, 60, 102, 96, 124, 102,
			102, 60, 0, 126, 102, 12, 24, 24, 24, 24, 0, 60, 102, 102, 60, 102, 102, 60, 0, 60, 102, 102, 62, 6, 102,
			60, 0, 0, 0, 24, 0, 0, 24, 0, 0, 0, 0, 24, 0, 0, 24, 24, 48, 14, 24, 48, 96, 48, 24, 14, 0, 0, 0, 126, 0,
			126, 0, 0, 0, 112, 24, 12, 6, 12, 24, 112, 0, 60, 102, 6, 12, 24, 0, 24, 0, 0, 0, 0, 255, 255, 0, 0, 0, 8,
			28, 62, 127, 127, 28, 62, 0, 24, 24, 24, 24, 24, 24, 24, 24, 0, 0, 0, 255, 255, 0, 0, 0, 0, 0, 255, 255, 0,
			0, 0, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 0, 0, 48, 48, 48, 48, 48, 48, 48, 48, 12, 12, 12,
			12, 12, 12, 12, 12, 0, 0, 0, 224, 240, 56, 24, 24, 24, 24, 28, 15, 7, 0, 0, 0, 24, 24, 56, 240, 224, 0, 0,
			0, 192, 192, 192, 192, 192, 192, 255, 255, 192, 224, 112, 56, 28, 14, 7, 3, 3, 7, 14, 28, 56, 112, 224, 192,
			255, 255, 192, 192, 192, 192, 192, 192, 255, 255, 3, 3, 3, 3, 3, 3, 0, 60, 126, 126, 126, 126, 60, 0, 0, 0,
			0, 0, 0, 255, 255, 0, 54, 127, 127, 127, 62, 28, 8, 0, 96, 96, 96, 96, 96, 96, 96, 96, 0, 0, 0, 7, 15, 28,
			24, 24, 195, 231, 126, 60, 60, 126, 231, 195, 0, 60, 126, 102, 102, 126, 60, 0, 24, 24, 102, 102, 24, 24,
			60, 0, 6, 6, 6, 6, 6, 6, 6, 6, 8, 28, 62, 127, 62, 28, 8, 0, 24, 24, 24, 255, 255, 24, 24, 24, 192, 192, 48,
			48, 192, 192, 48, 48, 24, 24, 24, 24, 24, 24, 24, 24, 0, 0, 3, 62, 118, 54, 54, 0, 255, 127, 63, 31, 15, 7,
			3, 1, 0, 0, 0, 0, 0, 0, 0, 0, 240, 240, 240, 240, 240, 240, 240, 240, 0, 0, 0, 0, 255, 255, 255, 255, 255,
			0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 192, 192, 192, 192, 192, 192, 192, 192, 204, 204, 51, 51,
			204, 204, 51, 51, 3, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 204, 204, 51, 51, 255, 254, 252, 248, 240, 224, 192,
			128, 3, 3, 3, 3, 3, 3, 3, 3, 24, 24, 24, 31, 31, 24, 24, 24, 0, 0, 0, 0, 15, 15, 15, 15, 24, 24, 24, 31, 31,
			0, 0, 0, 0, 0, 0, 248, 248, 24, 24, 24, 0, 0, 0, 0, 0, 0, 255, 255, 0, 0, 0, 31, 31, 24, 24, 24, 24, 24, 24,
			255, 255, 0, 0, 0, 0, 0, 0, 255, 255, 24, 24, 24, 24, 24, 24, 248, 248, 24, 24, 24, 192, 192, 192, 192, 192,
			192, 192, 192, 224, 224, 224, 224, 224, 224, 224, 224, 7, 7, 7, 7, 7, 7, 7, 7, 255, 255, 0, 0, 0, 0, 0, 0,
			255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 3, 3, 3, 3, 3, 3, 255, 255, 0, 0, 0, 0, 240,
			240, 240, 240, 15, 15, 15, 15, 0, 0, 0, 0, 24, 24, 24, 248, 248, 0, 0, 0, 240, 240, 240, 240, 0, 0, 0, 0,
			240, 240, 240, 240, 15, 15, 15, 15, 195, 153, 145, 145, 159, 153, 195, 255, 231, 195, 153, 129, 153, 153,
			153, 255, 131, 153, 153, 131, 153, 153, 131, 255, 195, 153, 159, 159, 159, 153, 195, 255, 135, 147, 153,
			153, 153, 147, 135, 255, 129, 159, 159, 135, 159, 159, 129, 255, 129, 159, 159, 135, 159, 159, 159, 255,
			195, 153, 159, 145, 153, 153, 195, 255, 153, 153, 153, 129, 153, 153, 153, 255, 195, 231, 231, 231, 231,
			231, 195, 255, 225, 243, 243, 243, 243, 147, 199, 255, 153, 147, 135, 143, 135, 147, 153, 255, 159, 159,
			159, 159, 159, 159, 129, 255, 156, 136, 128, 148, 156, 156, 156, 255, 153, 137, 129, 129, 145, 153, 153,
			255, 195, 153, 153, 153, 153, 153, 195, 255, 131, 153, 153, 131, 159, 159, 159, 255, 195, 153, 153, 153,
			153, 195, 241, 255, 131, 153, 153, 131, 135, 147, 153, 255, 195, 153, 159, 195, 249, 153, 195, 255, 129,
			231, 231, 231, 231, 231, 231, 255, 153, 153, 153, 153, 153, 153, 195, 255, 153, 153, 153, 153, 153, 195,
			231, 255, 156, 156, 156, 148, 128, 136, 156, 255, 153, 153, 195, 231, 195, 153, 153, 255, 153, 153, 153,
			195, 231, 231, 231, 255, 129, 249, 243, 231, 207, 159, 129, 255, 195, 207, 207, 207, 207, 207, 195, 255,
			243, 237, 207, 131, 207, 157, 3, 255, 195, 243, 243, 243, 243, 243, 195, 255, 255, 231, 195, 129, 231, 231,
			231, 231, 255, 239, 207, 128, 128, 207, 239, 255, 255, 255, 255, 255, 255, 255, 255, 255, 231, 231, 231,
			231, 255, 255, 231, 255, 153, 153, 153, 255, 255, 255, 255, 255, 153, 153, 0, 153, 0, 153, 153, 255, 231,
			193, 159, 195, 249, 131, 231, 255, 157, 153, 243, 231, 207, 153, 185, 255, 195, 153, 195, 199, 152, 153,
			192, 255, 249, 243, 231, 255, 255, 255, 255, 255, 243, 231, 207, 207, 207, 231, 243, 255, 207, 231, 243,
			243, 243, 231, 207, 255, 255, 153, 195, 0, 195, 153, 255, 255, 255, 231, 231, 129, 231, 231, 255, 255, 255,
			255, 255, 255, 255, 231, 231, 207, 255, 255, 255, 129, 255, 255, 255, 255, 255, 255, 255, 255, 255, 231,
			231, 255, 255, 252, 249, 243, 231, 207, 159, 255, 195, 153, 145, 137, 153, 153, 195, 255, 231, 231, 199,
			231, 231, 231, 129, 255, 195, 153, 249, 243, 207, 159, 129, 255, 195, 153, 249, 227, 249, 153, 195, 255,
			249, 241, 225, 153, 128, 249, 249, 255, 129, 159, 131, 249, 249, 153, 195, 255, 195, 153, 159, 131, 153,
			153, 195, 255, 129, 153, 243, 231, 231, 231, 231, 255, 195, 153, 153, 195, 153, 153, 195, 255, 195, 153,
			153, 193, 249, 153, 195, 255, 255, 255, 231, 255, 255, 231, 255, 255, 255, 255, 231, 255, 255, 231, 231,
			207, 241, 231, 207, 159, 207, 231, 241, 255, 255, 255, 129, 255, 129, 255, 255, 255, 143, 231, 243, 249,
			243, 231, 143, 255, 195, 153, 249, 243, 231, 255, 231, 255, 255, 255, 255, 0, 0, 255, 255, 255, 247, 227,
			193, 128, 128, 227, 193, 255, 231, 231, 231, 231, 231, 231, 231, 231, 255, 255, 255, 0, 0, 255, 255, 255,
			255, 255, 0, 0, 255, 255, 255, 255, 255, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 255, 255,
			207, 207, 207, 207, 207, 207, 207, 207, 243, 243, 243, 243, 243, 243, 243, 243, 255, 255, 255, 31, 15, 199,
			231, 231, 231, 231, 227, 240, 248, 255, 255, 255, 231, 231, 199, 15, 31, 255, 255, 255, 63, 63, 63, 63, 63,
			63, 0, 0, 63, 31, 143, 199, 227, 241, 248, 252, 252, 248, 241, 227, 199, 143, 31, 63, 0, 0, 63, 63, 63, 63,
			63, 63, 0, 0, 252, 252, 252, 252, 252, 252, 255, 195, 129, 129, 129, 129, 195, 255, 255, 255, 255, 255, 255,
			0, 0, 255, 201, 128, 128, 128, 193, 227, 247, 255, 159, 159, 159, 159, 159, 159, 159, 159, 255, 255, 255,
			248, 240, 227, 231, 231, 60, 24, 129, 195, 195, 129, 24, 60, 255, 195, 129, 153, 153, 129, 195, 255, 231,
			231, 153, 153, 231, 231, 195, 255, 249, 249, 249, 249, 249, 249, 249, 249, 247, 227, 193, 128, 193, 227,
			247, 255, 231, 231, 231, 0, 0, 231, 231, 231, 63, 63, 207, 207, 63, 63, 207, 207, 231, 231, 231, 231, 231,
			231, 231, 231, 255, 255, 252, 193, 137, 201, 201, 255, 0, 128, 192, 224, 240, 248, 252, 254, 255, 255, 255,
			255, 255, 255, 255, 255, 15, 15, 15, 15, 15, 15, 15, 15, 255, 255, 255, 255, 0, 0, 0, 0, 0, 255, 255, 255,
			255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 63, 63, 63, 63, 63, 63, 63, 63, 51, 51, 204, 204,
			51, 51, 204, 204, 252, 252, 252, 252, 252, 252, 252, 252, 255, 255, 255, 255, 51, 51, 204, 204, 0, 1, 3, 7,
			15, 31, 63, 127, 252, 252, 252, 252, 252, 252, 252, 252, 231, 231, 231, 224, 224, 231, 231, 231, 255, 255,
			255, 255, 240, 240, 240, 240, 231, 231, 231, 224, 224, 255, 255, 255, 255, 255, 255, 7, 7, 231, 231, 231,
			255, 255, 255, 255, 255, 255, 0, 0, 255, 255, 255, 224, 224, 231, 231, 231, 231, 231, 231, 0, 0, 255, 255,
			255, 255, 255, 255, 0, 0, 231, 231, 231, 231, 231, 231, 7, 7, 231, 231, 231, 63, 63, 63, 63, 63, 63, 63, 63,
			31, 31, 31, 31, 31, 31, 31, 31, 248, 248, 248, 248, 248, 248, 248, 248, 0, 0, 255, 255, 255, 255, 255, 255,
			0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 252, 252, 252, 252, 252, 252, 0, 0, 255,
			255, 255, 255, 15, 15, 15, 15, 240, 240, 240, 240, 255, 255, 255, 255, 231, 231, 231, 7, 7, 255, 255, 255,
			15, 15, 15, 15, 255, 255, 255, 255, 15, 15, 15, 15, 240, 240, 240, 240 };

	/** The Commodore 64 lower case character set */
	private static int[] C64_LOWERCASE = { 60, 102, 110, 110, 96, 98, 60, 0, 0, 0, 60, 6, 62, 102, 62, 0, 0, 96, 96,
			124, 102, 102, 124, 0, 0, 0, 60, 96, 96, 96, 60, 0, 0, 6, 6, 62, 102, 102, 62, 0, 0, 0, 60, 102, 126, 96,
			60, 0, 0, 14, 24, 62, 24, 24, 24, 0, 0, 0, 62, 102, 102, 62, 6, 124, 0, 96, 96, 124, 102, 102, 102, 0, 0,
			24, 0, 56, 24, 24, 60, 0, 0, 6, 0, 6, 6, 6, 6, 60, 0, 96, 96, 108, 120, 108, 102, 0, 0, 56, 24, 24, 24, 24,
			60, 0, 0, 0, 102, 127, 127, 107, 99, 0, 0, 0, 124, 102, 102, 102, 102, 0, 0, 0, 60, 102, 102, 102, 60, 0, 0,
			0, 124, 102, 102, 124, 96, 96, 0, 0, 62, 102, 102, 62, 6, 6, 0, 0, 124, 102, 96, 96, 96, 0, 0, 0, 62, 96,
			60, 6, 124, 0, 0, 24, 126, 24, 24, 24, 14, 0, 0, 0, 102, 102, 102, 102, 62, 0, 0, 0, 102, 102, 102, 60, 24,
			0, 0, 0, 99, 107, 127, 62, 54, 0, 0, 0, 102, 60, 24, 60, 102, 0, 0, 0, 102, 102, 102, 62, 12, 120, 0, 0,
			126, 12, 24, 48, 126, 0, 60, 48, 48, 48, 48, 48, 60, 0, 12, 18, 48, 124, 48, 98, 252, 0, 60, 12, 12, 12, 12,
			12, 60, 0, 0, 24, 60, 126, 24, 24, 24, 24, 0, 16, 48, 127, 127, 48, 16, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 24,
			24, 24, 0, 0, 24, 0, 102, 102, 102, 0, 0, 0, 0, 0, 102, 102, 255, 102, 255, 102, 102, 0, 24, 62, 96, 60, 6,
			124, 24, 0, 98, 102, 12, 24, 48, 102, 70, 0, 60, 102, 60, 56, 103, 102, 63, 0, 6, 12, 24, 0, 0, 0, 0, 0, 12,
			24, 48, 48, 48, 24, 12, 0, 48, 24, 12, 12, 12, 24, 48, 0, 0, 102, 60, 255, 60, 102, 0, 0, 0, 24, 24, 126,
			24, 24, 0, 0, 0, 0, 0, 0, 0, 24, 24, 48, 0, 0, 0, 126, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 24, 0, 0, 3, 6, 12,
			24, 48, 96, 0, 60, 102, 110, 118, 102, 102, 60, 0, 24, 24, 56, 24, 24, 24, 126, 0, 60, 102, 6, 12, 48, 96,
			126, 0, 60, 102, 6, 28, 6, 102, 60, 0, 6, 14, 30, 102, 127, 6, 6, 0, 126, 96, 124, 6, 6, 102, 60, 0, 60,
			102, 96, 124, 102, 102, 60, 0, 126, 102, 12, 24, 24, 24, 24, 0, 60, 102, 102, 60, 102, 102, 60, 0, 60, 102,
			102, 62, 6, 102, 60, 0, 0, 0, 24, 0, 0, 24, 0, 0, 0, 0, 24, 0, 0, 24, 24, 48, 14, 24, 48, 96, 48, 24, 14, 0,
			0, 0, 126, 0, 126, 0, 0, 0, 112, 24, 12, 6, 12, 24, 112, 0, 60, 102, 6, 12, 24, 0, 24, 0, 0, 0, 0, 255, 255,
			0, 0, 0, 24, 60, 102, 126, 102, 102, 102, 0, 124, 102, 102, 124, 102, 102, 124, 0, 60, 102, 96, 96, 96, 102,
			60, 0, 120, 108, 102, 102, 102, 108, 120, 0, 126, 96, 96, 120, 96, 96, 126, 0, 126, 96, 96, 120, 96, 96, 96,
			0, 60, 102, 96, 110, 102, 102, 60, 0, 102, 102, 102, 126, 102, 102, 102, 0, 60, 24, 24, 24, 24, 24, 60, 0,
			30, 12, 12, 12, 12, 108, 56, 0, 102, 108, 120, 112, 120, 108, 102, 0, 96, 96, 96, 96, 96, 96, 126, 0, 99,
			119, 127, 107, 99, 99, 99, 0, 102, 118, 126, 126, 110, 102, 102, 0, 60, 102, 102, 102, 102, 102, 60, 0, 124,
			102, 102, 124, 96, 96, 96, 0, 60, 102, 102, 102, 102, 60, 14, 0, 124, 102, 102, 124, 120, 108, 102, 0, 60,
			102, 96, 60, 6, 102, 60, 0, 126, 24, 24, 24, 24, 24, 24, 0, 102, 102, 102, 102, 102, 102, 60, 0, 102, 102,
			102, 102, 102, 60, 24, 0, 99, 99, 99, 107, 127, 119, 99, 0, 102, 102, 60, 24, 60, 102, 102, 0, 102, 102,
			102, 60, 24, 24, 24, 0, 126, 6, 12, 24, 48, 96, 126, 0, 24, 24, 24, 255, 255, 24, 24, 24, 192, 192, 48, 48,
			192, 192, 48, 48, 24, 24, 24, 24, 24, 24, 24, 24, 51, 51, 204, 204, 51, 51, 204, 204, 51, 153, 204, 102, 51,
			153, 204, 102, 0, 0, 0, 0, 0, 0, 0, 0, 240, 240, 240, 240, 240, 240, 240, 240, 0, 0, 0, 0, 255, 255, 255,
			255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 192, 192, 192, 192, 192, 192, 192, 192, 204, 204,
			51, 51, 204, 204, 51, 51, 3, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 204, 204, 51, 51, 204, 153, 51, 102, 204, 153,
			51, 102, 3, 3, 3, 3, 3, 3, 3, 3, 24, 24, 24, 31, 31, 24, 24, 24, 0, 0, 0, 0, 15, 15, 15, 15, 24, 24, 24, 31,
			31, 0, 0, 0, 0, 0, 0, 248, 248, 24, 24, 24, 0, 0, 0, 0, 0, 0, 255, 255, 0, 0, 0, 31, 31, 24, 24, 24, 24, 24,
			24, 255, 255, 0, 0, 0, 0, 0, 0, 255, 255, 24, 24, 24, 24, 24, 24, 248, 248, 24, 24, 24, 192, 192, 192, 192,
			192, 192, 192, 192, 224, 224, 224, 224, 224, 224, 224, 224, 7, 7, 7, 7, 7, 7, 7, 7, 255, 255, 0, 0, 0, 0, 0,
			0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 1, 3, 6, 108, 120, 112, 96, 0, 0, 0, 0, 0,
			240, 240, 240, 240, 15, 15, 15, 15, 0, 0, 0, 0, 24, 24, 24, 248, 248, 0, 0, 0, 240, 240, 240, 240, 0, 0, 0,
			0, 240, 240, 240, 240, 15, 15, 15, 15, 195, 153, 145, 145, 159, 153, 195, 255, 255, 255, 195, 249, 193, 153,
			193, 255, 255, 159, 159, 131, 153, 153, 131, 255, 255, 255, 195, 159, 159, 159, 195, 255, 255, 249, 249,
			193, 153, 153, 193, 255, 255, 255, 195, 153, 129, 159, 195, 255, 255, 241, 231, 193, 231, 231, 231, 255,
			255, 255, 193, 153, 153, 193, 249, 131, 255, 159, 159, 131, 153, 153, 153, 255, 255, 231, 255, 199, 231,
			231, 195, 255, 255, 249, 255, 249, 249, 249, 249, 195, 255, 159, 159, 147, 135, 147, 153, 255, 255, 199,
			231, 231, 231, 231, 195, 255, 255, 255, 153, 128, 128, 148, 156, 255, 255, 255, 131, 153, 153, 153, 153,
			255, 255, 255, 195, 153, 153, 153, 195, 255, 255, 255, 131, 153, 153, 131, 159, 159, 255, 255, 193, 153,
			153, 193, 249, 249, 255, 255, 131, 153, 159, 159, 159, 255, 255, 255, 193, 159, 195, 249, 131, 255, 255,
			231, 129, 231, 231, 231, 241, 255, 255, 255, 153, 153, 153, 153, 193, 255, 255, 255, 153, 153, 153, 195,
			231, 255, 255, 255, 156, 148, 128, 193, 201, 255, 255, 255, 153, 195, 231, 195, 153, 255, 255, 255, 153,
			153, 153, 193, 243, 135, 255, 255, 129, 243, 231, 207, 129, 255, 195, 207, 207, 207, 207, 207, 195, 255,
			243, 237, 207, 131, 207, 157, 3, 255, 195, 243, 243, 243, 243, 243, 195, 255, 255, 231, 195, 129, 231, 231,
			231, 231, 255, 239, 207, 128, 128, 207, 239, 255, 255, 255, 255, 255, 255, 255, 255, 255, 231, 231, 231,
			231, 255, 255, 231, 255, 153, 153, 153, 255, 255, 255, 255, 255, 153, 153, 0, 153, 0, 153, 153, 255, 231,
			193, 159, 195, 249, 131, 231, 255, 157, 153, 243, 231, 207, 153, 185, 255, 195, 153, 195, 199, 152, 153,
			192, 255, 249, 243, 231, 255, 255, 255, 255, 255, 243, 231, 207, 207, 207, 231, 243, 255, 207, 231, 243,
			243, 243, 231, 207, 255, 255, 153, 195, 0, 195, 153, 255, 255, 255, 231, 231, 129, 231, 231, 255, 255, 255,
			255, 255, 255, 255, 231, 231, 207, 255, 255, 255, 129, 255, 255, 255, 255, 255, 255, 255, 255, 255, 231,
			231, 255, 255, 252, 249, 243, 231, 207, 159, 255, 195, 153, 145, 137, 153, 153, 195, 255, 231, 231, 199,
			231, 231, 231, 129, 255, 195, 153, 249, 243, 207, 159, 129, 255, 195, 153, 249, 227, 249, 153, 195, 255,
			249, 241, 225, 153, 128, 249, 249, 255, 129, 159, 131, 249, 249, 153, 195, 255, 195, 153, 159, 131, 153,
			153, 195, 255, 129, 153, 243, 231, 231, 231, 231, 255, 195, 153, 153, 195, 153, 153, 195, 255, 195, 153,
			153, 193, 249, 153, 195, 255, 255, 255, 231, 255, 255, 231, 255, 255, 255, 255, 231, 255, 255, 231, 231,
			207, 241, 231, 207, 159, 207, 231, 241, 255, 255, 255, 129, 255, 129, 255, 255, 255, 143, 231, 243, 249,
			243, 231, 143, 255, 195, 153, 249, 243, 231, 255, 231, 255, 255, 255, 255, 0, 0, 255, 255, 255, 231, 195,
			153, 129, 153, 153, 153, 255, 131, 153, 153, 131, 153, 153, 131, 255, 195, 153, 159, 159, 159, 153, 195,
			255, 135, 147, 153, 153, 153, 147, 135, 255, 129, 159, 159, 135, 159, 159, 129, 255, 129, 159, 159, 135,
			159, 159, 159, 255, 195, 153, 159, 145, 153, 153, 195, 255, 153, 153, 153, 129, 153, 153, 153, 255, 195,
			231, 231, 231, 231, 231, 195, 255, 225, 243, 243, 243, 243, 147, 199, 255, 153, 147, 135, 143, 135, 147,
			153, 255, 159, 159, 159, 159, 159, 159, 129, 255, 156, 136, 128, 148, 156, 156, 156, 255, 153, 137, 129,
			129, 145, 153, 153, 255, 195, 153, 153, 153, 153, 153, 195, 255, 131, 153, 153, 131, 159, 159, 159, 255,
			195, 153, 153, 153, 153, 195, 241, 255, 131, 153, 153, 131, 135, 147, 153, 255, 195, 153, 159, 195, 249,
			153, 195, 255, 129, 231, 231, 231, 231, 231, 231, 255, 153, 153, 153, 153, 153, 153, 195, 255, 153, 153,
			153, 153, 153, 195, 231, 255, 156, 156, 156, 148, 128, 136, 156, 255, 153, 153, 195, 231, 195, 153, 153,
			255, 153, 153, 153, 195, 231, 231, 231, 255, 129, 249, 243, 231, 207, 159, 129, 255, 231, 231, 231, 0, 0,
			231, 231, 231, 63, 63, 207, 207, 63, 63, 207, 207, 231, 231, 231, 231, 231, 231, 231, 231, 204, 204, 51, 51,
			204, 204, 51, 51, 204, 102, 51, 153, 204, 102, 51, 153, 255, 255, 255, 255, 255, 255, 255, 255, 15, 15, 15,
			15, 15, 15, 15, 15, 255, 255, 255, 255, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
			255, 255, 255, 255, 0, 63, 63, 63, 63, 63, 63, 63, 63, 51, 51, 204, 204, 51, 51, 204, 204, 252, 252, 252,
			252, 252, 252, 252, 252, 255, 255, 255, 255, 51, 51, 204, 204, 51, 102, 204, 153, 51, 102, 204, 153, 252,
			252, 252, 252, 252, 252, 252, 252, 231, 231, 231, 224, 224, 231, 231, 231, 255, 255, 255, 255, 240, 240,
			240, 240, 231, 231, 231, 224, 224, 255, 255, 255, 255, 255, 255, 7, 7, 231, 231, 231, 255, 255, 255, 255,
			255, 255, 0, 0, 255, 255, 255, 224, 224, 231, 231, 231, 231, 231, 231, 0, 0, 255, 255, 255, 255, 255, 255,
			0, 0, 231, 231, 231, 231, 231, 231, 7, 7, 231, 231, 231, 63, 63, 63, 63, 63, 63, 63, 63, 31, 31, 31, 31, 31,
			31, 31, 31, 248, 248, 248, 248, 248, 248, 248, 248, 0, 0, 255, 255, 255, 255, 255, 255, 0, 0, 0, 255, 255,
			255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 254, 252, 249, 147, 135, 143, 159, 255, 255, 255, 255, 255,
			15, 15, 15, 15, 240, 240, 240, 240, 255, 255, 255, 255, 231, 231, 231, 7, 7, 255, 255, 255, 15, 15, 15, 15,
			255, 255, 255, 255, 15, 15, 15, 15, 240, 240, 240, 240 };

	/** The Commodore PET upper case character set */
	private static int[] PET_LOWERCASE = { 28, 34, 74, 86, 76, 32, 30, 0, 0, 0, 56, 4, 60, 68, 58, 0, 64, 64, 92, 98,
			66, 98, 92, 0, 0, 0, 60, 66, 64, 66, 60, 0, 2, 2, 58, 70, 66, 70, 58, 0, 0, 0, 60, 66, 126, 64, 60, 0, 12,
			18, 16, 124, 16, 16, 16, 0, 0, 0, 58, 70, 70, 58, 2, 60, 64, 64, 92, 98, 66, 66, 66, 0, 8, 0, 24, 8, 8, 8,
			28, 0, 4, 0, 12, 4, 4, 4, 68, 56, 64, 64, 68, 72, 80, 104, 68, 0, 24, 8, 8, 8, 8, 8, 28, 0, 0, 0, 118, 73,
			73, 73, 73, 0, 0, 0, 92, 98, 66, 66, 66, 0, 0, 0, 60, 66, 66, 66, 60, 0, 0, 0, 92, 98, 98, 92, 64, 64, 0, 0,
			58, 70, 70, 58, 2, 2, 0, 0, 92, 98, 64, 64, 64, 0, 0, 0, 62, 64, 60, 2, 124, 0, 16, 16, 124, 16, 16, 18, 12,
			0, 0, 0, 66, 66, 66, 70, 58, 0, 0, 0, 66, 66, 66, 36, 24, 0, 0, 0, 65, 73, 73, 73, 54, 0, 0, 0, 66, 36, 24,
			36, 66, 0, 0, 0, 66, 66, 70, 58, 2, 60, 0, 0, 126, 4, 24, 32, 126, 0, 60, 32, 32, 32, 32, 32, 60, 0, 0, 64,
			32, 16, 8, 4, 2, 0, 60, 4, 4, 4, 4, 4, 60, 0, 0, 8, 28, 42, 8, 8, 8, 8, 0, 0, 16, 32, 127, 32, 16, 0, 0, 0,
			0, 0, 0, 0, 0, 0, 8, 8, 8, 8, 0, 0, 8, 0, 36, 36, 36, 0, 0, 0, 0, 0, 36, 36, 126, 36, 126, 36, 36, 0, 8, 30,
			40, 28, 10, 60, 8, 0, 0, 98, 100, 8, 16, 38, 70, 0, 48, 72, 72, 48, 74, 68, 58, 0, 4, 8, 16, 0, 0, 0, 0, 0,
			4, 8, 16, 16, 16, 8, 4, 0, 32, 16, 8, 8, 8, 16, 32, 0, 8, 42, 28, 62, 28, 42, 8, 0, 0, 8, 8, 62, 8, 8, 0, 0,
			0, 0, 0, 0, 0, 8, 8, 16, 0, 0, 0, 126, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 24, 0, 0, 2, 4, 8, 16, 32, 64, 0, 60,
			66, 70, 90, 98, 66, 60, 0, 8, 24, 40, 8, 8, 8, 62, 0, 60, 66, 2, 12, 48, 64, 126, 0, 60, 66, 2, 28, 2, 66,
			60, 0, 4, 12, 20, 36, 126, 4, 4, 0, 126, 64, 120, 4, 2, 68, 56, 0, 28, 32, 64, 124, 66, 66, 60, 0, 126, 66,
			4, 8, 16, 16, 16, 0, 60, 66, 66, 60, 66, 66, 60, 0, 60, 66, 66, 62, 2, 4, 56, 0, 0, 0, 8, 0, 0, 8, 0, 0, 0,
			0, 8, 0, 0, 8, 8, 16, 14, 24, 48, 96, 48, 24, 14, 0, 0, 0, 126, 0, 126, 0, 0, 0, 112, 24, 12, 6, 12, 24,
			112, 0, 60, 66, 2, 12, 16, 0, 16, 0, 0, 0, 0, 0, 255, 0, 0, 0, 24, 36, 66, 126, 66, 66, 66, 0, 124, 34, 34,
			60, 34, 34, 124, 0, 28, 34, 64, 64, 64, 34, 28, 0, 120, 36, 34, 34, 34, 36, 120, 0, 126, 64, 64, 120, 64,
			64, 126, 0, 126, 64, 64, 120, 64, 64, 64, 0, 28, 34, 64, 78, 66, 34, 28, 0, 66, 66, 66, 126, 66, 66, 66, 0,
			28, 8, 8, 8, 8, 8, 28, 0, 14, 4, 4, 4, 4, 68, 56, 0, 66, 68, 72, 112, 72, 68, 66, 0, 64, 64, 64, 64, 64, 64,
			126, 0, 66, 102, 90, 90, 66, 66, 66, 0, 66, 98, 82, 74, 70, 66, 66, 0, 24, 36, 66, 66, 66, 36, 24, 0, 124,
			66, 66, 124, 64, 64, 64, 0, 24, 36, 66, 66, 74, 36, 26, 0, 124, 66, 66, 124, 72, 68, 66, 0, 60, 66, 64, 60,
			2, 66, 60, 0, 62, 8, 8, 8, 8, 8, 8, 0, 66, 66, 66, 66, 66, 66, 60, 0, 66, 66, 66, 36, 36, 24, 24, 0, 66, 66,
			66, 90, 90, 102, 66, 0, 66, 66, 36, 24, 36, 66, 66, 0, 34, 34, 34, 28, 8, 8, 8, 0, 126, 2, 4, 24, 32, 64,
			126, 0, 8, 8, 8, 8, 255, 8, 8, 8, 160, 80, 160, 80, 160, 80, 160, 80, 8, 8, 8, 8, 8, 8, 8, 8, 204, 204, 51,
			51, 204, 204, 51, 51, 204, 102, 51, 153, 204, 102, 51, 153, 0, 0, 0, 0, 0, 0, 0, 0, 240, 240, 240, 240, 240,
			240, 240, 240, 0, 0, 0, 0, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 128, 128,
			128, 128, 128, 128, 128, 128, 170, 85, 170, 85, 170, 85, 170, 85, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 170,
			85, 170, 85, 153, 51, 102, 204, 153, 51, 102, 204, 3, 3, 3, 3, 3, 3, 3, 3, 8, 8, 8, 8, 15, 8, 8, 8, 0, 0, 0,
			0, 15, 15, 15, 15, 8, 8, 8, 8, 15, 0, 0, 0, 0, 0, 0, 0, 248, 8, 8, 8, 0, 0, 0, 0, 0, 0, 255, 255, 0, 0, 0,
			0, 15, 8, 8, 8, 8, 8, 8, 8, 255, 0, 0, 0, 0, 0, 0, 0, 255, 8, 8, 8, 8, 8, 8, 8, 248, 8, 8, 8, 192, 192, 192,
			192, 192, 192, 192, 192, 224, 224, 224, 224, 224, 224, 224, 224, 7, 7, 7, 7, 7, 7, 7, 7, 255, 255, 0, 0, 0,
			0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 1, 2, 68, 72, 80, 96, 64, 0, 0, 0, 0,
			0, 240, 240, 240, 240, 15, 15, 15, 15, 0, 0, 0, 0, 8, 8, 8, 8, 248, 0, 0, 0, 240, 240, 240, 240, 0, 0, 0, 0,
			240, 240, 240, 240, 15, 15, 15, 15, 227, 221, 181, 169, 179, 223, 225, 255, 255, 255, 199, 251, 195, 187,
			197, 255, 191, 191, 163, 157, 189, 157, 163, 255, 255, 255, 195, 189, 191, 189, 195, 255, 253, 253, 197,
			185, 189, 185, 197, 255, 255, 255, 195, 189, 129, 191, 195, 255, 243, 237, 239, 131, 239, 239, 239, 255,
			255, 255, 197, 185, 185, 197, 253, 195, 191, 191, 163, 157, 189, 189, 189, 255, 247, 255, 231, 247, 247,
			247, 227, 255, 251, 255, 243, 251, 251, 251, 187, 199, 191, 191, 187, 183, 175, 151, 187, 255, 231, 247,
			247, 247, 247, 247, 227, 255, 255, 255, 137, 182, 182, 182, 182, 255, 255, 255, 163, 157, 189, 189, 189,
			255, 255, 255, 195, 189, 189, 189, 195, 255, 255, 255, 163, 157, 157, 163, 191, 191, 255, 255, 197, 185,
			185, 197, 253, 253, 255, 255, 163, 157, 191, 191, 191, 255, 255, 255, 193, 191, 195, 253, 131, 255, 239,
			239, 131, 239, 239, 237, 243, 255, 255, 255, 189, 189, 189, 185, 197, 255, 255, 255, 189, 189, 189, 219,
			231, 255, 255, 255, 190, 182, 182, 182, 201, 255, 255, 255, 189, 219, 231, 219, 189, 255, 255, 255, 189,
			189, 185, 197, 253, 195, 255, 255, 129, 251, 231, 223, 129, 255, 195, 223, 223, 223, 223, 223, 195, 255,
			255, 191, 223, 239, 247, 251, 253, 255, 195, 251, 251, 251, 251, 251, 195, 255, 255, 247, 227, 213, 247,
			247, 247, 247, 255, 255, 239, 223, 128, 223, 239, 255, 255, 255, 255, 255, 255, 255, 255, 255, 247, 247,
			247, 247, 255, 255, 247, 255, 219, 219, 219, 255, 255, 255, 255, 255, 219, 219, 129, 219, 129, 219, 219,
			255, 247, 225, 215, 227, 245, 195, 247, 255, 255, 157, 155, 247, 239, 217, 185, 255, 207, 183, 183, 207,
			181, 187, 197, 255, 251, 247, 239, 255, 255, 255, 255, 255, 251, 247, 239, 239, 239, 247, 251, 255, 223,
			239, 247, 247, 247, 239, 223, 255, 247, 213, 227, 193, 227, 213, 247, 255, 255, 247, 247, 193, 247, 247,
			255, 255, 255, 255, 255, 255, 255, 247, 247, 239, 255, 255, 255, 129, 255, 255, 255, 255, 255, 255, 255,
			255, 255, 231, 231, 255, 255, 253, 251, 247, 239, 223, 191, 255, 195, 189, 185, 165, 157, 189, 195, 255,
			247, 231, 215, 247, 247, 247, 193, 255, 195, 189, 253, 243, 207, 191, 129, 255, 195, 189, 253, 227, 253,
			189, 195, 255, 251, 243, 235, 219, 129, 251, 251, 255, 129, 191, 135, 251, 253, 187, 199, 255, 227, 223,
			191, 131, 189, 189, 195, 255, 129, 189, 251, 247, 239, 239, 239, 255, 195, 189, 189, 195, 189, 189, 195,
			255, 195, 189, 189, 193, 253, 251, 199, 255, 255, 255, 247, 255, 255, 247, 255, 255, 255, 255, 247, 255,
			255, 247, 247, 239, 241, 231, 207, 159, 207, 231, 241, 255, 255, 255, 129, 255, 129, 255, 255, 255, 143,
			231, 243, 249, 243, 231, 143, 255, 195, 189, 253, 243, 239, 255, 239, 255, 255, 255, 255, 255, 0, 255, 255,
			255, 231, 219, 189, 129, 189, 189, 189, 255, 131, 221, 221, 195, 221, 221, 131, 255, 227, 221, 191, 191,
			191, 221, 227, 255, 135, 219, 221, 221, 221, 219, 135, 255, 129, 191, 191, 135, 191, 191, 129, 255, 129,
			191, 191, 135, 191, 191, 191, 255, 227, 221, 191, 177, 189, 221, 227, 255, 189, 189, 189, 129, 189, 189,
			189, 255, 227, 247, 247, 247, 247, 247, 227, 255, 241, 251, 251, 251, 251, 187, 199, 255, 189, 187, 183,
			143, 183, 187, 189, 255, 191, 191, 191, 191, 191, 191, 129, 255, 189, 153, 165, 165, 189, 189, 189, 255,
			189, 157, 173, 181, 185, 189, 189, 255, 231, 219, 189, 189, 189, 219, 231, 255, 131, 189, 189, 131, 191,
			191, 191, 255, 231, 219, 189, 189, 181, 219, 229, 255, 131, 189, 189, 131, 183, 187, 189, 255, 195, 189,
			191, 195, 253, 189, 195, 255, 193, 247, 247, 247, 247, 247, 247, 255, 189, 189, 189, 189, 189, 189, 195,
			255, 189, 189, 189, 219, 219, 231, 231, 255, 189, 189, 189, 165, 165, 153, 189, 255, 189, 189, 219, 231,
			219, 189, 189, 255, 221, 221, 221, 227, 247, 247, 247, 255, 129, 253, 251, 231, 223, 191, 129, 255, 247,
			247, 247, 247, 0, 247, 247, 247, 95, 175, 95, 175, 95, 175, 95, 175, 247, 247, 247, 247, 247, 247, 247, 247,
			51, 51, 204, 204, 51, 51, 204, 204, 51, 153, 204, 102, 51, 153, 204, 102, 255, 255, 255, 255, 255, 255, 255,
			255, 15, 15, 15, 15, 15, 15, 15, 15, 255, 255, 255, 255, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255,
			255, 255, 255, 255, 255, 255, 255, 0, 127, 127, 127, 127, 127, 127, 127, 127, 85, 170, 85, 170, 85, 170, 85,
			170, 254, 254, 254, 254, 254, 254, 254, 254, 255, 255, 255, 255, 85, 170, 85, 170, 102, 204, 153, 51, 102,
			204, 153, 51, 252, 252, 252, 252, 252, 252, 252, 252, 247, 247, 247, 247, 240, 247, 247, 247, 255, 255, 255,
			255, 240, 240, 240, 240, 247, 247, 247, 247, 240, 255, 255, 255, 255, 255, 255, 255, 7, 247, 247, 247, 255,
			255, 255, 255, 255, 255, 0, 0, 255, 255, 255, 255, 240, 247, 247, 247, 247, 247, 247, 247, 0, 255, 255, 255,
			255, 255, 255, 255, 0, 247, 247, 247, 247, 247, 247, 247, 7, 247, 247, 247, 63, 63, 63, 63, 63, 63, 63, 63,
			31, 31, 31, 31, 31, 31, 31, 31, 248, 248, 248, 248, 248, 248, 248, 248, 0, 0, 255, 255, 255, 255, 255, 255,
			0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 254, 253, 187, 183, 175, 159, 191, 255,
			255, 255, 255, 255, 15, 15, 15, 15, 240, 240, 240, 240, 255, 255, 255, 255, 247, 247, 247, 247, 7, 255, 255,
			255, 15, 15, 15, 15, 255, 255, 255, 255, 15, 15, 15, 15, 240, 240, 240, 240 };

	/** The Commodore PET upper case character set */
	private static int[] PET_UPPERCASE = { 28, 34, 74, 86, 76, 32, 30, 0, 24, 36, 66, 126, 66, 66, 66, 0, 124, 34, 34,
			60, 34, 34, 124, 0, 28, 34, 64, 64, 64, 34, 28, 0, 120, 36, 34, 34, 34, 36, 120, 0, 126, 64, 64, 120, 64,
			64, 126, 0, 126, 64, 64, 120, 64, 64, 64, 0, 28, 34, 64, 78, 66, 34, 28, 0, 66, 66, 66, 126, 66, 66, 66, 0,
			28, 8, 8, 8, 8, 8, 28, 0, 14, 4, 4, 4, 4, 68, 56, 0, 66, 68, 72, 112, 72, 68, 66, 0, 64, 64, 64, 64, 64, 64,
			126, 0, 66, 102, 90, 90, 66, 66, 66, 0, 66, 98, 82, 74, 70, 66, 66, 0, 24, 36, 66, 66, 66, 36, 24, 0, 124,
			66, 66, 124, 64, 64, 64, 0, 24, 36, 66, 66, 74, 36, 26, 0, 124, 66, 66, 124, 72, 68, 66, 0, 60, 66, 64, 60,
			2, 66, 60, 0, 62, 8, 8, 8, 8, 8, 8, 0, 66, 66, 66, 66, 66, 66, 60, 0, 66, 66, 66, 36, 36, 24, 24, 0, 66, 66,
			66, 90, 90, 102, 66, 0, 66, 66, 36, 24, 36, 66, 66, 0, 34, 34, 34, 28, 8, 8, 8, 0, 126, 2, 4, 24, 32, 64,
			126, 0, 60, 32, 32, 32, 32, 32, 60, 0, 0, 64, 32, 16, 8, 4, 2, 0, 60, 4, 4, 4, 4, 4, 60, 0, 0, 8, 28, 42, 8,
			8, 8, 8, 0, 0, 16, 32, 127, 32, 16, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 8, 8, 8, 0, 0, 8, 0, 36, 36, 36, 0, 0, 0,
			0, 0, 36, 36, 126, 36, 126, 36, 36, 0, 8, 30, 40, 28, 10, 60, 8, 0, 0, 98, 100, 8, 16, 38, 70, 0, 48, 72,
			72, 48, 74, 68, 58, 0, 4, 8, 16, 0, 0, 0, 0, 0, 4, 8, 16, 16, 16, 8, 4, 0, 32, 16, 8, 8, 8, 16, 32, 0, 8,
			42, 28, 62, 28, 42, 8, 0, 0, 8, 8, 62, 8, 8, 0, 0, 0, 0, 0, 0, 0, 8, 8, 16, 0, 0, 0, 126, 0, 0, 0, 0, 0, 0,
			0, 0, 0, 24, 24, 0, 0, 2, 4, 8, 16, 32, 64, 0, 60, 66, 70, 90, 98, 66, 60, 0, 8, 24, 40, 8, 8, 8, 62, 0, 60,
			66, 2, 12, 48, 64, 126, 0, 60, 66, 2, 28, 2, 66, 60, 0, 4, 12, 20, 36, 126, 4, 4, 0, 126, 64, 120, 4, 2, 68,
			56, 0, 28, 32, 64, 124, 66, 66, 60, 0, 126, 66, 4, 8, 16, 16, 16, 0, 60, 66, 66, 60, 66, 66, 60, 0, 60, 66,
			66, 62, 2, 4, 56, 0, 0, 0, 8, 0, 0, 8, 0, 0, 0, 0, 8, 0, 0, 8, 8, 16, 14, 24, 48, 96, 48, 24, 14, 0, 0, 0,
			126, 0, 126, 0, 0, 0, 112, 24, 12, 6, 12, 24, 112, 0, 60, 66, 2, 12, 16, 0, 16, 0, 0, 0, 0, 0, 255, 0, 0, 0,
			8, 28, 62, 127, 127, 28, 62, 0, 16, 16, 16, 16, 16, 16, 16, 16, 0, 0, 0, 255, 0, 0, 0, 0, 0, 0, 255, 0, 0,
			0, 0, 0, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 0, 32, 32, 32, 32, 32, 32, 32, 32, 4, 4, 4, 4, 4,
			4, 4, 4, 0, 0, 0, 0, 224, 16, 8, 8, 8, 8, 8, 4, 3, 0, 0, 0, 8, 8, 8, 16, 224, 0, 0, 0, 128, 128, 128, 128,
			128, 128, 128, 255, 128, 64, 32, 16, 8, 4, 2, 1, 1, 2, 4, 8, 16, 32, 64, 128, 255, 128, 128, 128, 128, 128,
			128, 128, 255, 1, 1, 1, 1, 1, 1, 1, 0, 60, 126, 126, 126, 126, 60, 0, 0, 0, 0, 0, 0, 0, 255, 0, 54, 127,
			127, 127, 62, 28, 8, 0, 64, 64, 64, 64, 64, 64, 64, 64, 0, 0, 0, 0, 3, 4, 8, 8, 129, 66, 36, 24, 24, 36, 66,
			129, 0, 60, 66, 66, 66, 66, 60, 0, 8, 28, 42, 119, 42, 8, 8, 0, 2, 2, 2, 2, 2, 2, 2, 2, 8, 28, 62, 127, 62,
			28, 8, 0, 8, 8, 8, 8, 255, 8, 8, 8, 160, 80, 160, 80, 160, 80, 160, 80, 8, 8, 8, 8, 8, 8, 8, 8, 0, 0, 1, 62,
			84, 20, 20, 0, 255, 127, 63, 31, 15, 7, 3, 1, 0, 0, 0, 0, 0, 0, 0, 0, 240, 240, 240, 240, 240, 240, 240,
			240, 0, 0, 0, 0, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 128, 128, 128, 128,
			128, 128, 128, 128, 170, 85, 170, 85, 170, 85, 170, 85, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 170, 85, 170,
			85, 255, 254, 252, 248, 240, 224, 192, 128, 3, 3, 3, 3, 3, 3, 3, 3, 8, 8, 8, 8, 15, 8, 8, 8, 0, 0, 0, 0, 15,
			15, 15, 15, 8, 8, 8, 8, 15, 0, 0, 0, 0, 0, 0, 0, 248, 8, 8, 8, 0, 0, 0, 0, 0, 0, 255, 255, 0, 0, 0, 0, 15,
			8, 8, 8, 8, 8, 8, 8, 255, 0, 0, 0, 0, 0, 0, 0, 255, 8, 8, 8, 8, 8, 8, 8, 248, 8, 8, 8, 192, 192, 192, 192,
			192, 192, 192, 192, 224, 224, 224, 224, 224, 224, 224, 224, 7, 7, 7, 7, 7, 7, 7, 7, 255, 255, 0, 0, 0, 0, 0,
			0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 1, 1, 1, 1, 1, 1, 1, 255, 0, 0, 0, 0, 240,
			240, 240, 240, 15, 15, 15, 15, 0, 0, 0, 0, 8, 8, 8, 8, 248, 0, 0, 0, 240, 240, 240, 240, 0, 0, 0, 0, 240,
			240, 240, 240, 15, 15, 15, 15, 227, 221, 181, 169, 179, 223, 225, 255, 231, 219, 189, 129, 189, 189, 189,
			255, 131, 221, 221, 195, 221, 221, 131, 255, 227, 221, 191, 191, 191, 221, 227, 255, 135, 219, 221, 221,
			221, 219, 135, 255, 129, 191, 191, 135, 191, 191, 129, 255, 129, 191, 191, 135, 191, 191, 191, 255, 227,
			221, 191, 177, 189, 221, 227, 255, 189, 189, 189, 129, 189, 189, 189, 255, 227, 247, 247, 247, 247, 247,
			227, 255, 241, 251, 251, 251, 251, 187, 199, 255, 189, 187, 183, 143, 183, 187, 189, 255, 191, 191, 191,
			191, 191, 191, 129, 255, 189, 153, 165, 165, 189, 189, 189, 255, 189, 157, 173, 181, 185, 189, 189, 255,
			231, 219, 189, 189, 189, 219, 231, 255, 131, 189, 189, 131, 191, 191, 191, 255, 231, 219, 189, 189, 181,
			219, 229, 255, 131, 189, 189, 131, 183, 187, 189, 255, 195, 189, 191, 195, 253, 189, 195, 255, 193, 247,
			247, 247, 247, 247, 247, 255, 189, 189, 189, 189, 189, 189, 195, 255, 189, 189, 189, 219, 219, 231, 231,
			255, 189, 189, 189, 165, 165, 153, 189, 255, 189, 189, 219, 231, 219, 189, 189, 255, 221, 221, 221, 227,
			247, 247, 247, 255, 129, 253, 251, 231, 223, 191, 129, 255, 195, 223, 223, 223, 223, 223, 195, 255, 255,
			191, 223, 239, 247, 251, 253, 255, 195, 251, 251, 251, 251, 251, 195, 255, 255, 247, 227, 213, 247, 247,
			247, 247, 255, 255, 239, 223, 128, 223, 239, 255, 255, 255, 255, 255, 255, 255, 255, 255, 247, 247, 247,
			247, 255, 255, 247, 255, 219, 219, 219, 255, 255, 255, 255, 255, 219, 219, 129, 219, 129, 219, 219, 255,
			247, 225, 215, 227, 245, 195, 247, 255, 255, 157, 155, 247, 239, 217, 185, 255, 207, 183, 183, 207, 181,
			187, 197, 255, 251, 247, 239, 255, 255, 255, 255, 255, 251, 247, 239, 239, 239, 247, 251, 255, 223, 239,
			247, 247, 247, 239, 223, 255, 247, 213, 227, 193, 227, 213, 247, 255, 255, 247, 247, 193, 247, 247, 255,
			255, 255, 255, 255, 255, 255, 247, 247, 239, 255, 255, 255, 129, 255, 255, 255, 255, 255, 255, 255, 255,
			255, 231, 231, 255, 255, 253, 251, 247, 239, 223, 191, 255, 195, 189, 185, 165, 157, 189, 195, 255, 247,
			231, 215, 247, 247, 247, 193, 255, 195, 189, 253, 243, 207, 191, 129, 255, 195, 189, 253, 227, 253, 189,
			195, 255, 251, 243, 235, 219, 129, 251, 251, 255, 129, 191, 135, 251, 253, 187, 199, 255, 227, 223, 191,
			131, 189, 189, 195, 255, 129, 189, 251, 247, 239, 239, 239, 255, 195, 189, 189, 195, 189, 189, 195, 255,
			195, 189, 189, 193, 253, 251, 199, 255, 255, 255, 247, 255, 255, 247, 255, 255, 255, 255, 247, 255, 255,
			247, 247, 239, 241, 231, 207, 159, 207, 231, 241, 255, 255, 255, 129, 255, 129, 255, 255, 255, 143, 231,
			243, 249, 243, 231, 143, 255, 195, 189, 253, 243, 239, 255, 239, 255, 255, 255, 255, 255, 0, 255, 255, 255,
			247, 227, 193, 128, 128, 227, 193, 255, 239, 239, 239, 239, 239, 239, 239, 239, 255, 255, 255, 0, 255, 255,
			255, 255, 255, 255, 0, 255, 255, 255, 255, 255, 255, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
			255, 0, 255, 255, 223, 223, 223, 223, 223, 223, 223, 223, 251, 251, 251, 251, 251, 251, 251, 251, 255, 255,
			255, 255, 31, 239, 247, 247, 247, 247, 247, 251, 252, 255, 255, 255, 247, 247, 247, 239, 31, 255, 255, 255,
			127, 127, 127, 127, 127, 127, 127, 0, 127, 191, 223, 239, 247, 251, 253, 254, 254, 253, 251, 247, 239, 223,
			191, 127, 0, 127, 127, 127, 127, 127, 127, 127, 0, 254, 254, 254, 254, 254, 254, 254, 255, 195, 129, 129,
			129, 129, 195, 255, 255, 255, 255, 255, 255, 255, 0, 255, 201, 128, 128, 128, 193, 227, 247, 255, 191, 191,
			191, 191, 191, 191, 191, 191, 255, 255, 255, 255, 252, 251, 247, 247, 126, 189, 219, 231, 231, 219, 189,
			126, 255, 195, 189, 189, 189, 189, 195, 255, 247, 227, 213, 136, 213, 247, 247, 255, 253, 253, 253, 253,
			253, 253, 253, 253, 247, 227, 193, 128, 193, 227, 247, 255, 247, 247, 247, 247, 0, 247, 247, 247, 95, 175,
			95, 175, 95, 175, 95, 175, 247, 247, 247, 247, 247, 247, 247, 247, 255, 255, 254, 193, 171, 235, 235, 255,
			0, 128, 192, 224, 240, 248, 252, 254, 255, 255, 255, 255, 255, 255, 255, 255, 15, 15, 15, 15, 15, 15, 15,
			15, 255, 255, 255, 255, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
			0, 127, 127, 127, 127, 127, 127, 127, 127, 85, 170, 85, 170, 85, 170, 85, 170, 254, 254, 254, 254, 254, 254,
			254, 254, 255, 255, 255, 255, 85, 170, 85, 170, 0, 1, 3, 7, 15, 31, 63, 127, 252, 252, 252, 252, 252, 252,
			252, 252, 247, 247, 247, 247, 240, 247, 247, 247, 255, 255, 255, 255, 240, 240, 240, 240, 247, 247, 247,
			247, 240, 255, 255, 255, 255, 255, 255, 255, 7, 247, 247, 247, 255, 255, 255, 255, 255, 255, 0, 0, 255, 255,
			255, 255, 240, 247, 247, 247, 247, 247, 247, 247, 0, 255, 255, 255, 255, 255, 255, 255, 0, 247, 247, 247,
			247, 247, 247, 247, 7, 247, 247, 247, 63, 63, 63, 63, 63, 63, 63, 63, 31, 31, 31, 31, 31, 31, 31, 31, 248,
			248, 248, 248, 248, 248, 248, 248, 0, 0, 255, 255, 255, 255, 255, 255, 0, 0, 0, 255, 255, 255, 255, 255,
			255, 255, 255, 255, 255, 0, 0, 0, 254, 254, 254, 254, 254, 254, 254, 0, 255, 255, 255, 255, 15, 15, 15, 15,
			240, 240, 240, 240, 255, 255, 255, 255, 247, 247, 247, 247, 7, 255, 255, 255, 15, 15, 15, 15, 255, 255, 255,
			255, 15, 15, 15, 15, 240, 240, 240, 240 };

	// With the current rendering algorithm, there is probably no need to support
	// scaling, but it can be reused in other respects, for instance in a screen
	// editor. So we're keeping it for now.
	private int scale = 1;

	private Canvas canvas;

	public CharacterMapRendering(String renderingId) {
		super(renderingId);
		DebugPlugin.getDefault().addDebugEventListener(this);
	}

	@Override
	public Control getControl() {
		return fRoot;
	}

	private void createCharacterImages(GC gc, int fontIndex, int[] bytes) {
		for (int charIndex = 0; charIndex < 256; charIndex++) {
			// Recreate ImageData for each character
			ImageData imageData = new ImageData(CHAR_SIZE, CHAR_SIZE, 1,
					new PaletteData(new RGB[] { new RGB(47, 44, 155), new RGB(112, 109, 235) }));

			// Populate the ImageData with the character's bitmap
			for (int y = 0; y < CHAR_SIZE; y++) {
				int byteIndex = charIndex * CHAR_SIZE + y;
				int r = bytes[byteIndex]; // Get the byte for this row of the character
				for (int x = 0; x < CHAR_SIZE; x++) {
					int bit = (r >> (7 - x)) & 1; // Extract the x-th bit
					// Scale the pixel into a larger block
					for (int sy = 0; sy < scale; sy++) {
						for (int sx = 0; sx < scale; sx++) {
							imageData.setPixel(x * scale + sx, y * scale + sy, bit);
						}
					}
				}
			}
			// dispose of the old image
			if (CHARACTER[fontIndex][charIndex] != null) {
				CHARACTER[fontIndex][charIndex].dispose();
			}
			// Save a new one
			Image characterImage = new Image(gc.getDevice(), imageData);
			CHARACTER[fontIndex][charIndex] = characterImage;
		}

	}

	@Override
	public Control createControl(Composite parent) {
		fRoot = new Composite(parent, SWT.NONE);
		fRoot.setLayout(new GridLayout());
		Composite controls = new Composite(fRoot, SWT.NONE);
		controls.setLayout(new GridLayout(4, false));

		Label label = new Label(controls, SWT.NONE);
		label.setText("Character set:");
		Combo charSet = new Combo(controls, SWT.READ_ONLY);
		charSet.add("C64 Upper Case");
		charSet.add("C64 Lower Case");
		charSet.add("PET Upper Case");
		charSet.add("PET Lower Case");
		charSet.add("Custom");
		charSet.select(0);
		charSet.addSelectionListener(new SelectionAdapter() {

			@Override
			public void widgetSelected(SelectionEvent e) {
				fontIndex = charSet.getSelectionIndex();
				canvas.redraw();
			}

		});

		Label addressLabel = new Label(controls, SWT.NONE);
		addressLabel.setText("Address:");
		Text address = new Text(controls, SWT.BORDER);
		address.addModifyListener(new ModifyListener() {

			@Override
			public void modifyText(ModifyEvent e) {
				// TODO Auto-generated method stub
			}
		});

		canvas = new Canvas(fRoot, SWT.DOUBLE_BUFFERED);
		canvas.setLayoutData(GridDataFactory.fillDefaults().grab(true, true).create());
		canvas.addPaintListener(e -> drawScreen(e.gc, canvas.getSize().x, canvas.getSize().y));
		return fRoot;
	}

	private void drawScreen(GC gc, int width, int height) {
		if (CHARACTER[0][0] == null) {
			createCharacterImages(gc, 0, C64_UPPERCASE);
			createCharacterImages(gc, 1, C64_LOWERCASE);
			createCharacterImages(gc, 2, PET_UPPERCASE);
			createCharacterImages(gc, 3, PET_LOWERCASE);
		}
		try {
			Image screen = new Image(gc.getDevice(), 320, 200);
			GC screenGC = new GC(screen);
			for (int x = 0; x < 40; x++) {
				for (int y = 0; y < 25; y++) {
					IMemoryBlock memoryBlock = getMemoryBlock();
					byte[] bytes = memoryBlock.getBytes();
					int c = bytes[y * 40 + x] & 0xFF;
					int xPos = x * CHAR_SIZE * scale;
					int yPos = y * CHAR_SIZE * scale;
					screenGC.drawImage(CHARACTER[fontIndex][c], 0, 0, CHAR_SIZE * scale, CHAR_SIZE * scale, xPos, yPos,
							CHAR_SIZE * scale, CHAR_SIZE * scale);
				}
			}
			gc.drawImage(screen, 0, 0, 320, 200, 0, 0, width, height);
			screen.dispose();
		} catch (DebugException e) {
			e.printStackTrace();
		}
	}

	@Override
	public void handleDebugEvents(DebugEvent[] events) {
		// TODO: Only react to events where screen must be repainted
		canvas.getDisplay().asyncExec(() -> {
			if (!canvas.isDisposed()) {
				canvas.redraw();
			}
		});
	}

}
